# ER-диаграмма базы данных

## Модели

### UserProfile (Профиль пользователя)
```
┌─────────────────────────────────┐
│       USERPROFILE               │
├─────────────────────────────────┤
│ PK  id (Integer)                │
│ FK  user_id (Integer)           │
│     bio (TextField)             │
│     avatar (ImageField)         │
│     created_at (DateTime)       │
└─────────────────────────────────┘
```

**Поля:**
- `id` - первичный ключ (автоинкремент)
- `user_id` - внешний ключ на User (связь один-к-одному)
- `bio` - описание профиля (макс. 500 символов)
- `avatar` - аватар пользователя (изображение)
- `created_at` - дата и время создания записи

---

### Platform (Платформа/Онлайн-школа)
```
┌─────────────────────────────────┐
│         PLATFORM                │
├─────────────────────────────────┤
│ PK  id (Integer)                │
│     name (CharField, 100)       │
│     description (TextField)     │
│     website (URLField)          │
│     created_at (DateTime)       │
└─────────────────────────────────┘
```

**Поля:**
- `id` - первичный ключ (автоинкремент)
- `name` - название платформы (макс. 100 символов, уникальное)
- `description` - описание платформы
- `website` - сайт платформы
- `created_at` - дата и время создания записи

---

### Course (Курс)
```
┌─────────────────────────────────┐
│          COURSE                 │
├─────────────────────────────────┤
│ PK  id (Integer)                │
│ FK  platform_id (Integer)       │
│     name (CharField, 200)       │
│     description (TextField)     │
│     course_url (URLField)       │
│     created_at (DateTime)       │
└─────────────────────────────────┘
```

**Поля:**
- `id` - первичный ключ (автоинкремент)
- `platform_id` - внешний ключ на Platform (связь многие-к-одному)
- `name` - название курса (макс. 200 символов)
- `description` - подробное описание курса
- `course_url` - ссылка на страницу курса
- `created_at` - дата и время создания записи

**Методы:**
- `average_rating()` - вычисляет среднюю оценку на основе всех отзывов

---

### Review (Отзыв)
```
┌─────────────────────────────────┐
│          REVIEW                 │
├─────────────────────────────────┤
│ PK  id (Integer)                │
│ FK  course_id (Integer)         │
│     author_name (CharField, 100)│
│     rating (Integer, 1-5)       │
│     text (TextField)            │
│     created_at (DateTime)       │
└─────────────────────────────────┘
```

**Поля:**
- `id` - первичный ключ (автоинкремент)
- `course_id` - внешний ключ на Course (связь многие-к-одному)
- `author_name` - имя автора отзыва (макс. 100 символов)
- `rating` - оценка от 1 до 5 (с валидацией)
- `text` - текст отзыва
- `created_at` - дата и время создания отзыва

---

## Связи между моделями

```
       USER                  USERPROFILE
    ┌──────┐                ┌──────────┐
    │  id  │◄───────────────│ user_id  │
    │ name │  One-to-One    │   bio    │
    └──────┘                │  avatar  │
       │                    └──────────┘
       │
       │ One-to-Many
       ▼
    REVIEW                     COURSE                    PLATFORM
┌──────────┐              ┌──────────────┐            ┌──────────┐
│ user_id  │              │ platform_id  │◄───────────│    id    │
│course_id │◄─────────────│      id      │One-to-Many │   name   │
│  rating  │ One-to-Many  │     name     │            │ website  │
│   text   │              │  course_url  │            └──────────┘
└──────────┘              └──────────────┘
```

**Связи:**

1. **User → UserProfile** (One-to-One)
   - Каждый пользователь имеет один профиль
   - Профиль создается автоматически при регистрации
   - При удалении пользователя удаляется профиль (CASCADE)
   - Обратная связь через `related_name='profile'`

2. **User → Review** (One-to-Many)
   - Один пользователь может оставить множество отзывов
   - Каждый отзыв принадлежит одному пользователю
   - При удалении пользователя удаляются все его отзывы (CASCADE)
   - Обратная связь через `related_name='reviews'`

3. **Platform → Course** (One-to-Many)
   - Одна платформа может иметь множество курсов
   - Каждый курс принадлежит одной платформе
   - При удалении платформы удаляются все её курсы (CASCADE)
   - Обратная связь через `related_name='courses'`

4. **Course → Review** (One-to-Many)
   - Один курс может иметь множество отзывов
   - Каждый отзыв принадлежит только одному курсу
   - При удалении курса удаляются все связанные отзывы (CASCADE)
   - Обратная связь через `related_name='reviews'`

---

## Индексы и оптимизация

**Автоматические индексы:**
- Primary Key на `id` во всех таблицах
- Foreign Key на `platform_id` в таблице Course
- Foreign Key на `course_id` в таблице Review
- Unique constraint на `name` в таблице Platform

**Сортировка по умолчанию:**
- Platform: `name` (по алфавиту)
- Course: `-created_at` (новые курсы первыми)
- Review: `-created_at` (новые отзывы первыми)

---

## Бизнес-логика

1. **Платформы как категории** - курсы группируются по платформам
2. **Средняя оценка курса** вычисляется динамически на основе всех отзывов
3. **Рекомендуемые курсы** - курсы со средней оценкой > 4.5
4. **Валидация рейтинга** - только значения от 1 до 5
5. **Ссылки на курсы** - возможность добавить прямую ссылку на курс
