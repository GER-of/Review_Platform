{% extends 'base.html' %}
{% load review_tags %}

{% block title %}{{ course.name }} - –û—Ç–∑—ã–≤—ã{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{% url 'home' %}">–ì–ª–∞–≤–Ω–∞—è</a> / <a href="{% url 'home' %}">–û—Ç–∑—ã–≤—ã –æ –∫—É—Ä—Å–∞—Ö</a> / {{ course.name }}
</div>

<div class="course-detail-page">
    <div class="detail-header">
        <div class="course-icon" style="background: #2196F3;">
            {{ course.name|slice:":2"|upper }}
        </div>
        <div class="detail-info">
            <h1>{{ course.name }}</h1>
            <div class="detail-meta">
                <div class="detail-rating">
                    <span class="star-icon">‚òÖ</span>
                    <span class="rating-number">{{ avg_rating|floatformat:1 }}</span>
                    <span class="reviews-count">{{ reviews.count|pluralize_reviews }}</span>
                </div>
            </div>
            <div class="course-meta-info">
                <span class="platform-badge-large">{{ course.platform.name }}</span>
                {% if course.course_url %}
                <a href="{{ course.course_url }}" target="_blank" class="btn-course-link">üîó –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫—É—Ä—Å</a>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="course-description-section">
        <h2 class="section-title">–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞</h2>
        <p class="description-text">{{ course.description }}</p>
    </div>
    
    <div class="add-review-section">
        <h2 class="section-title">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h2>
        {% if user.is_authenticated %}
        <form method="post" class="review-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label>{{ form.rating.label }}</label>
                <div class="rating-input">
                    {% for radio in form.rating %}
                    <label class="rating-option">
                        {{ radio.tag }}
                        <span class="rating-star">{{ radio.choice_label }} ‚òÖ</span>
                    </label>
                    {% endfor %}
                </div>
                {% if form.rating.errors %}
                <div class="form-error">{{ form.rating.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.text.id_for_label }}">{{ form.text.label }}</label>
                {{ form.text }}
                {% if form.text.errors %}
                <div class="form-error">{{ form.text.errors }}</div>
                {% endif %}
            </div>
            
            <button type="submit" class="btn-submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
        </form>
        {% else %}
        <div class="auth-required">
            <p>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a href="{% url 'login' %}?next={{ request.path }}">–≤–æ–π—Ç–∏</a> –∏–ª–∏ <a href="{% url 'register' %}">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>.</p>
        </div>
        {% endif %}
    </div>
    
    <div class="reviews-section">
        <h2 class="section-title">{{ reviews.count|pluralize_reviews }}</h2>
        
        {% for review in reviews %}
        <div class="review-card">
            <div class="review-with-avatar">
                <div class="review-avatar">
                    <img src="{% user_avatar review.user %}" alt="{{ review.author_name }}" class="avatar-img">
                </div>
                <div class="review-content-wrapper">
                    <div class="review-header">
                        <span class="review-author">{{ review.author_name }}</span>
                        <div class="review-rating">
                            {% for i in "12345" %}
                                {% if forloop.counter <= review.rating %}
                                    <span class="star filled">‚òÖ</span>
                                {% else %}
                                    <span class="star">‚òÜ</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <p class="review-text">{{ review.text }}</p>
                    <p class="review-date">{{ review.created_at|date:"d.m.Y" }}</p>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="no-data">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</div>
        {% endfor %}
    </div>
</div>
{% endblock %}
